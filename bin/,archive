#!/bin/bash

set -e

cd

mkdir -p Archive

if [ ! -f ~/.bucket ]
then
    echo 'Please create $HOME/.bucket'
    exit 1
fi

BUCKET=$(cat ~/.bucket)

if [ -z "$2" ]
then
    arg="-n"
    run () {
        "$@" 2>&1 | less
    }
else
    arg=""
    run () {
        "$@"
    }
fi

if [ "$1" = "out" ]
then
    run s3cmd sync -v $arg $HOME/Archive s3://$BUCKET/
elif [ "$1" = "in" ]
then
    run s3cmd sync -v $arg s3://$BUCKET/Archive/ $HOME/Archive/
else
    echo 'usage: ,archive in|out [go]'
fi
